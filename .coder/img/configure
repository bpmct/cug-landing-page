#!/bin/bash

# This script runs once the Coder workspace is started
# and the home directory is mounted and the workspace-agent
# has injected some programs (such as code-server)

# Create a .bash_profile file if it doesn't exist
if [ ! -f ~/.bash_profile ]; then
    touch ~/.bash_profile
    echo "#/bin/sh" > ~/.bash_profile
    echo "source ~/.bashrc" >> ~/.bash_profile
fi

# Create a .bashrc if it doesn't exist
if [ ! -f ~/.bashrc ]; then
    touch ~/.bashrc
    echo "#/bin/sh" > ~/.bashrc
fi

# Add an alias python=python3, if it doesn't exist
grep -qxF 'alias python=python3' /home/coder/.bashrc || echo 'alias python=python3' >> /home/coder/.bashrc

# Add an alias for code-server, if it doesn't exist
grep -qxF 'alias code-server=/var/tmp/coder/code-server/bin/code-server' /home/coder/.bashrc || echo 'alias code-server=/var/tmp/coder/code-server/bin/code-server' >> /home/coder/.bashrc

# Install the Python extension
/var/tmp/coder/code-server/bin/code-server --install-extension ms-python.python