#!/bin/bash

# This script runs once the Coder workspace is started
# and the home directory is mounted and the workspace-agent
# has injected some programs (such as code-server)

# Create a .bash_profile file if it doesn't exist
if [ ! -f ~/.bash_profile ]; then
    touch ~/.bash_profile
    echo "#/bin/bash" > ~/.bash_profile
    echo "source ~/.bashrc" >> ~/.bash_profile
fi

# Create a .bashrc if it doesn't exist
if [ ! -f ~/.bashrc ]; then
    touch ~/.bashrc
    echo "#/bin/bash" > ~/.bashrc
fi

# Add an alias python=python3, if it doesn't exist
grep -qxF 'alias python=python3' /home/coder/.bashrc || echo 'alias python=python3' >> /home/coder/.bashrc

# Add an alias for code-server, if it doesn't exist
grep -qxF 'alias code-server=/var/tmp/coder/code-server/bin/code-server' /home/coder/.bashrc || echo 'alias code-server=/var/tmp/coder/code-server/bin/code-server' >> /home/coder/.bashrc

# Add pip packages to PATH, if it doesn't exist
grep -qxF 'export PATH="$HOME/.local/bin:$PATH"' /home/coder/.bashrc || echo 'export PATH="$HOME/.local/bin:$PATH"' >> /home/coder/.bashrc

# Install the Python extension
/var/tmp/coder/code-server/bin/code-server --install-extension ms-python.python

# Install the Prettier extension
/var/tmp/coder/code-server/bin/code-server --install-extension esbenp.prettier-vscode

# Install the CodeTour extension
/var/tmp/coder/code-server/bin/code-server --install-extension /tmp/extensions/codetour-0.0.56.vsix

# Install the Tasks exension
/var/tmp/coder/code-server/bin/code-server --install-extension actboy168.tasks
